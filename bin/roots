#!/usr/bin/env node

var fs = require('fs');
var path = require('path');
var colors = require('colors');
var watch = require('watch');
var _ = require('underscore');
var coffeescript = require('../lib/compilers/coffee');

var current_directory = path.normalize(process.cwd());
var dir_contents = fs.readdirSync(current_directory);

// pulls out only the type of file you pass it in the directory you pass it
var get_files = function(dir, type){ 
  var all_files = fs.readdirSync(path.join(current_directory, dir));
  return _.filter(all_files, function(f){ return !!f.match(new RegExp('\.' + type + '$')); });
}

// make sure this is a roots project

if (_.include(dir_contents, 'package.json')) {
  // console.log('we have a legit app'.green);
} else {
  // console.log('looks like youre missing the app.js file, try running roots new `name` to create a new project'.red);
}

// compile all the things!\
coffeescript.compile(get_files('assets/js', 'coffee'));
// helpers.pass_through(get_files('assets/js', 'js'))

// serve to public and open the browser

// create a watch task that does this on file change

// create a websockets server to interact with livereload and push changes live